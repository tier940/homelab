# MinIO Tenant Development Environment Configuration
tenant:
  name: dev-storage

  # Root credentials - match with minio-secret.yaml
  configSecret:
    name: minio-tenant
    existingSecret: true

  # Pools configuration
  pools:
    - servers: 3
      name: pool-0
      volumesPerServer: 2
      size: 5Gi
      storageClassName: longhorn
      resources:
        requests:
          cpu: 200m
          memory: 500Mi
        limits:
          cpu: 500m
          memory: 1Gi

  # Buckets to create
  buckets:
    - name: prometheus
    - name: backup

  # TLS certificate configuration
  certificate:
    # Disable auto-cert for development
    requestAutoCert: false

  # Environment variables
  env:
    - name: MINIO_BROWSER
      value: "on"
    - name: MINIO_BROWSER_REDIRECT_URL
      value: "https://minio-console.k8s.tier.f5.si"
    - name: MINIO_PROMETHEUS_AUTH_TYPE
      value: "public"

  # Prometheus metrics configuration
  metrics:
    enabled: true
    port: 9000
    protocol: http

  # Add labels to MinIO services for ServiceMonitor discovery
  serviceMetadata:
    minioServiceLabels:
      metrics: enabled

# Ingress for MinIO Console
ingress:
  api:
    enabled: true
    ingressClassName: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
      traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect-https@kubernetescrd
    host: minio-api.k8s.tier.f5.si
    tls: []

  console:
    enabled: true
    ingressClassName: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
      traefik.ingress.kubernetes.io/router.middlewares: traefik-redirect-https@kubernetescrd
    host: minio-console.k8s.tier.f5.si
    tls: []

# Additional Kubernetes resources
extraResources:
  - |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      name: {{ .Values.tenant.name }}-metrics
      namespace: {{ .Release.Namespace }}
      labels:
        release: kube-prometheus-stack
    spec:
      selector:
        matchLabels:
          metrics: enabled
      namespaceSelector:
        matchNames:
          - {{ .Release.Namespace }}
      endpoints:
        - port: http-minio
          interval: 30s
          scrapeTimeout: 10s
          path: /minio/v2/metrics/cluster
          scheme: http
